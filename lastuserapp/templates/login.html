{% extends "layout.html" %}
{% from "baseframe/forms.html" import renderfield, rendersubmit, ajaxform %}
{% block title %}Login{% endblock %}
{% block headline %}{% endblock %}
{% block content %}
<div class="flash cookies-required-alert">
  <div class="flashmessage">
    Cookies are required to login. Please enable cookies in your browserâ€™s settings and reload this page.
  </div>
</div>
<div class="cookies-required form-horizontal">
  <h2>
    {%- if config['LOGIN_MESSAGE_1'] -%}
      {{ config['LOGIN_MESSAGE_1'] }}
    {%- else -%}
      Login with your existing account at any of these <small>(pick one)</small>
    {%- endif -%}
  </h2>
  <div class="control-group">
    <a class="loginbutton {%- if lastused=='twitter' %} lastused{% endif %}" href="{{ url_for('login_twitter', next=request.args.get('next')) }}"
        style="background-image: url({{ url_for('static', filename='img/login/twitter.png') }});">Twitter</a>
    <a class="loginbutton {%- if lastused=='google' %} lastused{% endif %}" href="{{ url_for('login_google', next=request.args.get('next')) }}"
        style="background-image: url({{ url_for('static', filename='img/login/google.png') }});">Google</a>
    <a class="loginbutton {%- if lastused=='github' %} lastused{% else %} optional jshidden{% endif %}" href="{{ url_for('login_github', next=request.args.get('next')) }}"
        style="background-image: url({{ url_for('static', filename='img/login/github.png') }});">GitHub</a>
    <a class="loginbutton {%- if lastused=='openid' %} lastused{% else %} optional jshidden{% endif %}" id="openidbutton" href="#openidform"
        style="background-image: url({{ url_for('static', filename='img/login/openid.png') }});">OpenID</a>
    <a class="loginbutton caption no-jshidden" id="showmore" href="">Show more...</a>
  </div>
  <form id="openidform" method="POST" class="jshidden">
    <input type="hidden" name="_charset_"/>
    <input type="hidden" name="form.id" value="openid"/>
    <input type="hidden" name="next" value="{{ oidnext }}"/>
    {{ openidform.hidden_tag() }}
    {% if openidform.csrf_token.errors %}
      {% for error in openidform.csrf_token.errors %}<div class="error">{{ error }}</div>{% endfor %}
    {% endif %}
    {% if oiderror %}<div class=error>{{ oiderror }}</div>{% endif %}
    {{ renderfield(openidform.openid, "small") }}
    {{ rendersubmit([(None, "Login", 'btn-primary')], "small") }}
  </form>
  <div id="passwordform" {%- if lastused != 'password' %} class="jshidden"{% endif %}>
    <h2>
      {%- if config['LOGIN_MESSAGE_2'] -%}
        {{ config['LOGIN_MESSAGE_2'] }}
      {%- else -%}
        Or, login with a password
      {%- endif -%}
    </h2>
    {% include "forms/loginform.html" %}
  </div>
</div>
{% endblock %}

{% block footerscripts %}
{{ ajaxform('login', request, True) }}
<script type="text/javascript">
  $(function() {
    {% if oiderror -%}
      $("#openid").removeClass('jshidden').focus();
    {% else -%}
      $("#openidform").hide().removeClass('jshidden');
    {% endif -%}
    {% if lastused != 'password' %}$("#passwordform").removeClass('jshidden').hide();{% endif %}
    $(".loginbutton.optional").hide().removeClass('jshidden');
    $("#openidbutton").click(function() {
      $("#openidform").fadeToggle();
      $("#openid").focus();
      return false;
    });
    $("#showmore").click(function() {
      $("#showmore").hide();
      $(".loginbutton.optional").fadeToggle();
      $("#passwordform").fadeIn();
      return false;
    });
  });
</script>
{% endblock %}
